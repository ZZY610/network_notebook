# 防火长城GFW
“防火长城”（Great Firewall，简称 GFW）是中国的国家级互联网过滤和监控系统，其主要目的是限制对某些海外网站和服务的访问，以达到网络监管和信息控制的目标。GFW 采用了多种技术手段来识别、拦截和限制网络流量，使得用户在国内访问某些外网服务时受到影响。以下是 GFW 的一些主要技术原理：

### 1. **DNS 污染（DNS Poisoning）**
   - **原理**：GFW 通过在 DNS 解析过程中返回错误的 IP 地址来阻止访问。用户访问一个域名时，计算机会向 DNS 服务器请求该域名的 IP 地址，而 GFW 在此过程中干扰 DNS 请求，返回不正确的 IP，导致用户无法正常访问目标网站。
   - **实现方式**：当 GFW 发现用户查询敏感的域名（例如 YouTube、Twitter 等）时，会向 DNS 请求返回一个假的 IP 地址，导致用户连接到无效服务器，出现无法访问或连接错误的情况。

### 2. **IP 封锁（IP Blocking）**
   - **原理**：GFW 通过拦截或屏蔽特定的 IP 地址，从而阻止用户直接连接到被封锁的网站。只要服务器的 IP 在 GFW 的封锁名单中，无论用户通过任何域名都无法访问这些 IP 地址。
   - **实现方式**：当用户试图访问受限 IP 地址时，GFW 会主动丢弃数据包或返回错误响应，通常表现为连接超时或直接被拒绝访问。这种技术适合封锁固定 IP 的网站，但对动态 IP 或 CDN 网络分发的内容相对无效。

### 3. **关键字过滤（Keyword Filtering）**
   - **原理**：GFW 会对用户访问的 HTTP 或 HTTPS 请求进行关键字检测，判断请求的内容或 URL 中是否包含敏感关键词。如果检测到关键词，就会阻断或中断连接。
   - **实现方式**：对于 HTTP 请求，GFW 可以直接读取明文请求中的内容，判断是否包含敏感关键词，然后直接中断连接。对于 HTTPS 请求，虽然内容被加密，但 GFW 仍能检查请求的域名（SNI 字段），并根据域名关键词来判断是否拦截请求。

### 4. **URL 拦截（URL Filtering）**
   - **原理**：GFW 可以通过检查 HTTP 请求的 URL 字段，判断是否需要对特定的 URL 进行拦截。对于指定的 URL 进行阻断，使得用户无法访问特定的页面或资源。
   - **实现方式**：在 HTTP 流量中，GFW 能够直接读取请求的完整 URL，根据内部的敏感 URL 黑名单对请求进行匹配，匹配成功时便会丢弃该请求，导致页面无法访问或出现连接超时。

### 5. **深度包检测（Deep Packet Inspection, DPI）**
   - **原理**：GFW 通过深度包检测技术（DPI）对网络流量进行深度分析，识别传输内容和流量特征，进一步拦截敏感的网络请求。DPI 技术可以分析数据包的负载，甚至可以检测 VPN 或其他加密协议的流量特征。
   - **实现方式**：GFW 对数据包进行逐层解析，查找其中可能存在的协议、关键词或敏感内容的特征，例如检测 HTTPS 连接中的 SNI 或 VPN 连接中的流量特征。如果检测到不符合规则的流量，会立刻阻断该连接。

### 6. **流量限速和带宽限制**
   - **原理**：对于一些流量较大的服务，GFW 会采取限速或带宽限制的手段，降低访问速度，从而影响用户体验。这种方法不会完全阻断访问，但会让连接变得极不稳定。
   - **实现方式**：GFW 通过动态检测流量，对特定的数据流应用限速策略，造成访问速度极慢，导致用户放弃访问。这种方法对于 P2P 流量、VPN 流量和视频流等带宽需求较大的数据尤其有效。

### 7. **TCP 重置（TCP Reset）**
   - **原理**：GFW 通过向通信双方发送伪造的 TCP 重置（RST）包来强制关闭连接。当用户发起敏感请求时，GFW 伪造并发送 RST 包，使用户与服务器的连接中断。
   - **实现方式**：当 GFW 检测到敏感流量时，立即向客户端和服务器发送一个 RST 包，以模拟对方主动断开连接的行为。连接被强制重置，用户会看到连接被意外中断的情况。

### 8. **阻断 VPN 和代理服务**
   - **原理**：GFW 通过检测和识别 VPN、代理等流量特征，对这些加密通信进行干扰和阻断，防止用户通过 VPN、代理等工具绕过限制访问外网。
   - **实现方式**：GFW 能识别一些常见的 VPN 协议（如 OpenVPN、IPSec、PPTP）的流量特征，通过 DPI 检查流量包的内容和通信模式。如果发现用户使用 VPN，GFW 会尝试封锁 VPN 服务器的 IP 地址或中断连接。

### 9. **TLS 中间人攻击（MITM, Man-In-The-Middle）**
   - **原理**：GFW 有时会通过中间人攻击，尝试解密 HTTPS 流量以检查是否包含敏感内容。这种方法允许 GFW 在解密数据包后直接分析流量内容。
   - **实现方式**：在 MITM 攻击中，GFW 扮演通信双方中的“中间人”，使用自己签发的伪造证书解密并重新加密 HTTPS 流量。这种方法主要用于监控高度敏感的目标，但较少使用，因为用户通常会看到证书错误提示，增加了被察觉的可能性。

### 总结

GFW 利用了多层次、多种技术的综合性过滤机制，在网络传输的各个阶段进行监控和阻断。GFW 的核心技术包括 DNS 污染、IP 封锁、关键字过滤、深度包检测（DPI）、TCP 重置、流量限速等，能够有效拦截用户对特定外网资源的访问请求。尽管一些技术手段可能被用户利用 VPN、代理、加密协议等规避，但 GFW 通过不断更新和调整封锁策略，始终保持对外网访问的严格控制。这种高度复杂的网络过滤系统为互联网内容控制提供了技术支持，也为用户的外网访问带来不小的挑战。

## 代理软件如何绕过GFW
你能够通过代理软件（如 Clash）顺利访问外网，主要原因是代理软件通过加密和分流技术绕过了 GFW 的部分封锁机制。这种方法虽然有效，但其背后涉及多个技术层面的规避机制。以下是详细的解释：

### 1. **加密和协议混淆**
   - **原理**：Clash 代理软件使用了 Shadowsocks、V2Ray、Trojan 等协议。这些协议会加密流量数据，使得 GFW 无法直接读取数据包的内容。加密后，GFW 只能看到数据包的外部特征（如源 IP 和目标 IP、端口等），而无法深入分析传输内容。
   - **协议混淆**：这些协议通常包含特定的混淆技术，以模拟正常 HTTPS 或其他常用流量特征，避免被 GFW 识别。例如，Trojan 通过 HTTPS 的特征传输数据，使流量看起来像普通的 HTTPS 浏览访问。

### 2. **分流和自动切换节点**
   - **原理**：Clash 的分流功能使得数据流量可以根据策略，选择不同的代理节点或不走代理（称为 “直连”）。这种策略配置避免了所有流量直接走代理，减小了被检测到的概率。
   - **自动切换节点**：Clash 配置中通常包括多个代理节点，且可以根据网络情况自动切换节点。如果某个节点被封锁，Clash 可以自动切换到其他未被封锁的节点，从而保持稳定的连接。

### 3. **绕过 DNS 污染**
   - **自定义 DNS 配置**：Clash 通常会使用自己的 DNS 解析服务，不依赖于 ISP（本地网络服务提供商）的 DNS，这样可以绕过 GFW 的 DNS 污染。Clash 中可以设置 DNS 配置，使用海外的公共 DNS 服务器（如 Google DNS、Cloudflare DNS）解析域名，从而获取正确的 IP 地址。
   - **DoH（DNS over HTTPS）**：一些代理软件（如 Clash）可以使用 DoH 协议来进行 DNS 查询。DoH 使用加密通道请求 DNS 服务器，从而防止 GFW 对 DNS 请求的拦截和污染。

### 4. **基于 HTTPS 隧道的流量伪装**
   - **HTTPS 隧道**：代理软件的通信数据通常通过 HTTPS 隧道传输，使得数据包看起来像普通的 HTTPS 流量。由于 HTTPS 协议是加密的，GFW 无法直接查看其中的内容。
   - **伪装成常见的网络流量**：一些协议（如 Trojan）设计上为了伪装成浏览器访问行为，利用标准的 HTTPS 特征来传输数据。GFW 在流量检测时将其误判为正常的 HTTPS 流量，因此不会封锁。

### 5. **动态端口和流量特征的灵活性**
   - **端口的随机性**：Clash 可以监听本地的任意端口（如 7890），并且传输协议端口也可以配置成动态端口，这样每次连接时端口不同，减少了被 GFW 静态端口封锁的可能。
   - **流量特征的多样化**：Clash 可以使用不同的代理协议（如 Shadowsocks、V2Ray、Trojan 等），每种协议的加密和数据分片特性不同，流量特征也不同。由于这些协议具有多种数据传输模式，GFW 很难实时封锁所有模式。

### 6. **绕过 IP 封锁**
   - **代理节点的分布广泛且经常更换**：Clash 的代理节点通常分布在不同的地区和 IP 地址段，且可能动态更新。GFW 虽然封锁了一些常见的代理 IP 地址，但新的节点会不断出现。通过更换代理节点，Clash 可以有效规避 GFW 的 IP 封锁。
   - **CDN 和云服务绕过 IP 封锁**：一些代理服务借助 CDN 和云服务平台提供节点。GFW 很难封锁所有的 CDN IP 段（如 Cloudflare、AWS 等），因此部分代理节点可以通过 CDN 技术绕过封锁。

### 总结

你能够成功访问外网，正是因为 Clash 利用了代理协议的加密、流量混淆、动态分流、伪装和 CDN 等技术手段，规避了 GFW 的拦截策略。Clash 软件的核心就是通过多种方式降低流量被 GFW 检测到的风险，从而实现稳定的网络穿越效果。这些技术不断演变，使得 GFW 需要通过更加复杂的检测手段来封锁代理软件，但也增加了封锁的难度和成本。

## 其它技术手段
除了代理软件 Clash，目前还有一些其他的技术手段和软件工具可以帮助绕过 GFW 实现访问外网的目的。这些方法大致可以分为以下几类：

### 1. **VPN（虚拟专用网络）**
   - **原理**：VPN 通过创建一个加密隧道，将所有网络流量传输到位于海外的 VPN 服务器上，使得流量在 GFW 中看起来像是访问 VPN 服务器本身，进而避免被检测到真实的目标地址。
   - **优点**：大部分商业 VPN 提供加密和伪装机制，易于使用且安全性较高。
   - **限制**：GFW 对一些常见的 VPN 端口进行了封锁，并且会检测 VPN 特征进行干扰，因此需要选择支持混淆协议的 VPN，或能绕过 GFW 封锁的 VPN 提供商。

### 2. **Shadowsocks（影梭）**
   - **原理**：Shadowsocks 是一种代理协议，使用了加密和流量伪装技术，能绕过 GFW 的识别。它通过将数据分片并加密的方式，使其看起来不像是正常的互联网流量，GFW 因此难以识别。
   - **优点**：Shadowsocks 是开源软件，支持跨平台部署和使用，且具有较高的隐蔽性。
   - **限制**：GFW 已经能够识别 Shadowsocks 的部分流量特征，对流量可能会有一定干扰，但仍然是广泛使用的工具。

### 3. **V2Ray**
   - **原理**：V2Ray 是一款具备多协议支持和强大混淆功能的代理软件。其支持 VMess、VLESS、Trojan 等协议，能够通过多种方式对流量进行混淆处理。
   - **优点**：支持动态端口和多种协议，使流量更加多样化，难以被 GFW 检测。
   - **限制**：V2Ray 的配置较为复杂，需要自行设置服务器端和客户端，且某些配置对网络质量和流量特征的要求较高。

### 4. **Trojan**
   - **原理**：Trojan 协议是基于 HTTPS 的代理协议，利用标准 HTTPS 流量特征进行加密传输，使得流量看起来像正常的浏览器访问。Trojan 可在加密和伪装层面隐藏流量特征，从而绕过 GFW。
   - **优点**：流量伪装效果好，适合高强度封锁环境下的使用，配置简单，能利用 SSL 加密实现更高的隐蔽性。
   - **限制**：需要有服务端支持，且要求较高的带宽质量。部分 Trojan 服务可能需要付费。

### 5. **SSH 隧道（Secure Shell）**
   - **原理**：SSH 隧道利用 SSH 协议来加密传输数据，数据通过远程服务器上的 SSH 服务实现转发，从而使 GFW 难以识别真实的流量。
   - **优点**：SSH 隧道相对稳定且易于设置，尤其适合临时的流量转发。
   - **限制**：需要服务器的 SSH 访问权限，且数据传输速度较慢，复杂应用场景不适用。

### 6. **Tor（洋葱路由）**
   - **原理**：Tor 是一款基于匿名网络的工具，通过将流量分段加密并随机路由到多个节点，形成“洋葱”层级式的传输结构，使得 GFW 难以识别其真实路径。
   - **优点**：Tor 隐蔽性极强，且具有较高的匿名性。
   - **限制**：GFW 封锁了许多 Tor 的节点，因此需要配置“网桥”节点（bridge）绕过封锁。另外，Tor 的速度较慢，不适合高频大流量访问。

### 7. **DNS over HTTPS（DoH）/DNS over TLS（DoT）**
   - **原理**：DoH 和 DoT 将 DNS 请求加密后通过 HTTPS 或 TLS 协议传输，避免 DNS 查询被篡改或污染。
   - **优点**：能够有效绕过 DNS 污染，使域名解析更加准确和安全。
   - **限制**：仅解决 DNS 层面的问题，对数据流量的传输部分仍需配合代理等手段。

### 8. **CDN 中转**
   - **原理**：CDN 中转是通过公共的 CDN 服务来转发流量，使数据绕过 GFW 的封锁。通常是利用 CDN 的服务器作为跳板，将请求转发到目标服务器。
   - **优点**：利用 CDN 难以被封锁的特点，使流量更隐蔽。
   - **限制**：需要特定的配置，且 CDN 的使用成本较高，可能不适合长期使用。

### 9. **HTTP/2 隧道**
   - **原理**：HTTP/2 协议允许多路复用流量，使得请求可以共享同一链接传输。通过代理将流量传输到海外服务器，借助 HTTP/2 的多路复用和加密特性伪装流量。
   - **优点**：适合在 HTTP 流量下伪装，使流量难以识别。
   - **限制**：需要专用的服务端支持，且配置复杂。

### 总结
要绕过 GFW 的封锁，目前大多需要依赖加密、流量混淆和分流技术。除了 Clash 这样的代理软件外，以上提到的 VPN、Shadowsocks、V2Ray、Trojan 等工具通过加密与伪装实现稳定的网络连接。结合 DNS over HTTPS 等配套手段，能进一步提高绕过封锁的成功率。